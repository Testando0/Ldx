<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crisálida Vision | Neural Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
        body { background-color: #000; color: #fff; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .glass { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); backdrop-filter: blur(12px); }
        .btn-glow:hover { box-shadow: 0 0 20px rgba(59, 130, 246, 0.4); transform: translateY(-2px); }
        .shimmer { animation: loading 1.5s infinite; background: linear-gradient(90deg, #0a0a0a 25%, #1a1a1a 50%, #0a0a0a 75%); background-size: 200% 100%; }
        @keyframes loading { from { background-position: 200% 0; } to { background-position: -200% 0; } }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <div class="w-full max-w-2xl space-y-8">
        <div class="text-center">
            <h1 class="text-4xl font-extrabold tracking-tighter mb-2 italic">CRISÁLIDA <span class="text-blue-500">VISION</span></h1>
            <p class="text-zinc-500 text-sm tracking-widest">BY REDZIN | SDXL LIGHTNING ENGINE</p>
        </div>

        <div class="glass p-2 rounded-2xl flex items-center group transition-all focus-within:border-blue-500/50">
            <input id="promptInput" type="text" placeholder="Descreva a imagem que deseja criar..." 
                   class="bg-transparent flex-1 p-4 outline-none text-white placeholder-zinc-700">
            <button id="generateBtn" class="bg-blue-600 text-white px-8 py-4 rounded-xl font-bold btn-glow transition-all active:scale-95">
                GERAR
            </button>
        </div>

        <div id="resultContainer" class="relative aspect-square w-full glass rounded-3xl overflow-hidden flex items-center justify-center border-2 border-dashed border-zinc-800">
            <div id="statusText" class="text-zinc-600 text-center p-8">
                <p>Os pixels serão sintetizados aqui.</p>
                <p class="text-xs mt-2 opacity-50">Use prompts detalhados para maior fidelidade.</p>
            </div>
            
            <img id="resultImage" class="hidden w-full h-full object-cover">
            
            <div id="loader" class="hidden absolute inset-0 shimmer flex flex-col items-center justify-center">
                <div class="w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"></div>
                <p class="text-xs font-bold tracking-[0.3em] text-blue-500">SINTETIZANDO</p>
            </div>
        </div>

        <button id="downloadBtn" class="hidden w-full py-4 glass rounded-xl font-bold hover:bg-white/5 transition-all flex items-center justify-center gap-2">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v4M7 10l5 5 5-5M12 15V3"/></svg>
            SALVAR EM ALTA DEFINIÇÃO
        </button>
    </div>

    <script>
        const btn = document.getElementById('generateBtn');
        const input = document.getElementById('promptInput');
        const image = document.getElementById('resultImage');
        const loader = document.getElementById('loader');
        const status = document.getElementById('statusText');
        const download = document.getElementById('downloadBtn');

        btn.onclick = async () => {
            const prompt = input.value.trim();
            if (!prompt) return;

            // UI State
            btn.disabled = true;
            loader.style.display = 'flex';
            status.classList.add('hidden');
            image.classList.add('hidden');
            download.classList.add('hidden');

            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: prompt })
                });

                if (response.status === 503) {
                    throw new Error("O modelo está acordando. Tente novamente em alguns segundos.");
                }

                if (!response.ok) throw new Error("Erro na geração. Verifique seu Token.");

                const blob = await response.blob();
                const url = URL.createObjectURL(blob);
                
                image.src = url;
                image.classList.remove('hidden');
                
                download.onclick = () => {
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `crisalida_${Date.now()}.png`;
                    a.click();
                };
                download.classList.remove('hidden');

            } catch (err) {
                alert(err.message);
                status.classList.remove('hidden');
            } finally {
                loader.style.display = 'none';
                btn.disabled = false;
            }
        };

        input.onkeydown = (e) => { if(e.key === 'Enter') btn.click(); };
    </script>
</body>
</html>
